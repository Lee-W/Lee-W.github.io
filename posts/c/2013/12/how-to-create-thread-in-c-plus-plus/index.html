
<!DOCTYPE html>
<html lang="zh">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/font-awesome/css/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta name="author" content="Lee-W" />
<meta name="description" content="之前因為作業需要使用到multi-thread，就留下了這篇紀錄 這篇會稍微介紹C++11 的thread函式庫，還有一點點和pthread" />
<meta name="keywords" content="Thread">
<meta property="og:site_name" content="Life Lies in Traveling"/>
<meta property="og:title" content="[C++] 如何create thread"/>
<meta property="og:description" content="之前因為作業需要使用到multi-thread，就留下了這篇紀錄 這篇會稍微介紹C++11 的thread函式庫，還有一點點和pthread"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://localhost:8000/posts/c/2013/12/how-to-create-thread-in-c-plus-plus"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-12-11 00:56:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://localhost:8000/author/lee-w.html">
<meta property="article:section" content="C++"/>
<meta property="article:tag" content="Thread"/>
<meta property="og:image" content="//s.gravatar.com/avatar/3e049ed33195d00a8b745b16c63dce6e?s=120">

  <title>Life Lies in Traveling &ndash; [C++] 如何create thread</title>

</head>
<body>
  <aside>
    <div>
      <a href="http://localhost:8000">
        <img src="//s.gravatar.com/avatar/3e049ed33195d00a8b745b16c63dce6e?s=120" alt="Lee-W" title="Lee-W">
      </a>
      <h1><a href="http://localhost:8000">Lee-W</a></h1>


      <nav>
        <ul class="list">
          <li><a href="http://localhost:8000/pages/about-me.html#about-me">About Me</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="http://tw.linkedin.com/in/clleew" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="http://github.com/Lee-W" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-facebook" href="http://www.facebook.com/clleew" target="_blank"><i class="fa fa-facebook"></i></a></li>
        <li><a class="sc-google" href="http://plus.google.com/113295124327840065090" target="_blank"><i class="fa fa-google"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="http://localhost:8000">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


    </nav>

<article class="single">
  <header>
    <h1 id="how-to-create-thread-in-c-plus-plus">[C++] 如何create thread</h1>
    <p>
          Posted on 2013/12/11 - 三 in <a href="http://localhost:8000/category/c.html">C++</a>


    </p>
  </header>


  <div>
    <p>之前因為作業需要使用到multi-thread，就留下了這篇紀錄<br>
這篇會稍微介紹C++11 的<code>thread</code>函式庫，還有一點點和<code>pthread</code></p>
<!--more-->

<p>要使用C++11的<code>thread</code>在編譯時要加上 <code>-std=c++11 -pthread</code> (<code>-std=c++ -lphread</code>好像也可以)<br>
ex: <code>g++ -o t thread.cpp -std=c++11 -pthread</code><br>
<code>-std=c++11</code> :  是指定c++的版本<br>
<code>-pthread</code> (或 <code>-lpthread</code>)：使用thread的liberary</p>
<p>下面有寫到join的部份<br>
join是開啟這個thread的上層程式必須等待到這個thread的工作結束了，才可以繼續下面的工作<br>
也就是join以上的程式會與thread搶CPU，join以後的程式就會等待到thread結束才開始</p>
<p>那就直接來看code吧<br>
</br><br>
</br><br>
</br></p>
<h2>C++ 11 thread</h2>
<h3>在main裡面直接開啟thread</h3>
<p>直接宣告thread型態的變數<br>
thread的constructor的第一個參數是函數名稱，第二個以後就是原本函數的參數</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>    

<span class="kt">void</span> <span class="nf">fun1</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;This is funtion1&quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">fun2</span><span class="p">(</span><span class="kt">int</span> <span class="n">p1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;This is function2&quot;</span><span class="o">&lt;&lt;</span><span class="n">p1</span><span class="o">&lt;&lt;</span><span class="n">p2</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">main</span><span class="p">(){</span>
        <span class="kr">thread</span> <span class="n">t1</span><span class="p">(</span><span class="n">fun1</span><span class="p">);</span>
        <span class="kr">thread</span> <span class="nf">t2</span><span class="p">(</span><span class="n">fun2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
        <span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
        <span class="n">t2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>這樣就可以產生兩個thread，他們會彼此搶CPU的資源<br>
cout似乎是每一個&lt;&lt;會去搶一次，所以如果想要一次印完全部，可能可以考慮使用printf或者是thread的lock功能</p>
<h3>在class內開啟thread</h3>
<p>用上面的方法直接呼叫同個class的function會出現錯誤<br>
所以就必須用下面的方法<br>
在宣告thread的時候<br>
第1個參數必須是這個function的完整reference<br>
第2個用this<br>
第3個以後才是原本function的參數<br>
p.s.如果fun1是static，則不用this</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">fun1</span><span class="p">(</span><span class="kt">int</span> <span class="n">p1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;This is funtion1&quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">void</span> <span class="n">fun2</span><span class="p">()</span> <span class="p">{</span>
                <span class="kr">thread</span> <span class="n">t</span><span class="p">(</span><span class="o">&amp;</span><span class="n">example</span><span class="o">::</span><span class="n">fun1</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">a</span><span class="p">.</span><span class="n">fun2</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>最後是如何呼叫其他class的function，這裡包含兩個例子(main, class B)<br>
想法跟上面那種很接近，只是第2個參數改成那個物件的實體</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;thread&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">fun1</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;This is funtion1&quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
        <span class="p">};</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">fun2</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;This is function2&quot;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

                <span class="kr">thread</span> <span class="nf">t</span><span class="p">(</span><span class="o">&amp;</span><span class="n">A</span><span class="o">::</span><span class="n">fun1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
                <span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
        <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
        <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">b</span><span class="p">.</span><span class="n">fun2</span><span class="p">();</span>

        <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
        <span class="kr">thread</span> <span class="nf">t1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">A</span><span class="o">::</span><span class="n">fun1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
        <span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p></br><br>
</br></p>
<h2>基本的pthread使用</h2>
<div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">arg</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">p1</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span><span class="o">*</span> <span class="nf">fun1</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">arg</span><span class="o">*</span> <span class="n">argument</span><span class="p">;</span>
        <span class="n">argument</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg</span><span class="o">*</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">argument</span><span class="o">-&gt;</span><span class="n">p1</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">arg</span><span class="o">*</span> <span class="n">argumentForFun1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">arg</span><span class="p">;</span>
        <span class="n">argumentForFun1</span><span class="o">-&gt;</span><span class="n">p1</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span>

        <span class="n">pthread_t</span> <span class="n">t1</span><span class="p">;</span>
        <span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">fun1</span><span class="p">,</span><span class="n">argumentForFun1</span><span class="p">);</span>
        <span class="n">pthread_join</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>至於pthread如何用在class的function上<br>
可以將function加上static<br>
同樣第3個參數也要改成&amp;A::fun1</p>
<h1>Reference</h1>
<ul>
<li>[資訊小兵的胡言亂語: [C++] Thread Function相關測試] (http://programmingpaul.blogspot.tw/2013/08/c-thread-function.html)</li>
<li>[解析Linux中多線程編程並傳遞多個參數實例] (http://17089349.blog.hexun.com.tw/65836836_d.html)</li>
<li>[linux下C/C++,多线程pthread] (http://www.cnblogs.com/xianghang123/archive/2011/08/11/2134927.html)</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://localhost:8000/tag/thread.html">Thread</a>
    </p>
  </div>




<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lee-w-blog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; Lee-W </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Life Lies in Traveling ",
  "url" : "http://localhost:8000",
  "image": "//s.gravatar.com/avatar/3e049ed33195d00a8b745b16c63dce6e?s=120",
  "description": ""
}
</script>
</body>
</html>